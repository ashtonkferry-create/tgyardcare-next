---
phase: 02-supabase-backend
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - "index.html"
  - "src/lib/analytics.ts"
autonomous: false
user_setup:
  - service: google_analytics
    why: "Website traffic and conversion tracking"
    account_setup:
      - task: "Create or sign in to Google Analytics account"
        url: "https://analytics.google.com"
      - task: "Create GA4 property"
        details: "Property name: TotalGuard Yard Care, Timezone: business timezone, Currency: USD"
      - task: "Copy Measurement ID (starts with G-)"
        location: "Admin -> Data Streams -> Web -> Measurement ID"

must_haves:
  truths:
    - "Google Analytics tracking script loads on every page"
    - "Page views are tracked automatically"
    - "Form submission events are tracked"
    - "Analytics data appears in GA4 dashboard within 24 hours"
  artifacts:
    - path: "index.html"
      provides: "GA4 tracking script in head"
      contains: "gtag"
    - path: "src/lib/analytics.ts"
      provides: "Analytics helper functions"
      exports: ["trackEvent", "trackPageView"]
      min_lines: 15
  key_links:
    - from: "index.html"
      to: "Google Analytics"
      via: "gtag script tag"
      pattern: "googletagmanager.*gtag"
    - from: "analytics.ts"
      to: "window.gtag"
      via: "gtag function calls"
      pattern: "window\\.gtag"
---

<objective>
Add Google Analytics 4 tracking to the website for traffic monitoring and conversion tracking.

Purpose: Enable the owner to monitor website performance, understand visitor behavior, and track form submissions.

Output: Working GA4 integration with page view tracking and custom event tracking for form submissions.
</objective>

<execution_context>
@C:\Users\vance\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\vance\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\Users\vance\OneDrive\Desktop\claude-workspace\.planning\PROJECT.md
@C:\Users\vance\OneDrive\Desktop\claude-workspace\.planning\ROADMAP.md
@C:\Users\vance\OneDrive\Desktop\claude-workspace\.planning\STATE.md

Key facts:
- Website on Lovable.dev at tgyardcare.com
- Contact form will send analytics events (referenced in Plan 02-02)
- Single admin user, basic analytics needs
- Free GA4 tier is sufficient

Note: This plan is independent of Supabase setup and can run in parallel with Plan 02-01.
</context>

<tasks>

<task type="checkpoint:human-action">
  <name>Set up Google Analytics 4 property and get Measurement ID</name>
  <action>
    You (the user) need to create a Google Analytics 4 property and retrieve the Measurement ID.

    1. Go to https://analytics.google.com
    2. Sign in with totalguardllc@gmail.com (or business Google account)
    3. If first time:
       - Click "Start measuring"
       - Account name: TotalGuard
       - Property name: TotalGuard Yard Care
       - Select timezone (your business location)
       - Currency: USD
       - Click "Next" and accept terms
    4. If account exists:
       - Click Admin (gear icon)
       - Create Property
       - Follow same property setup above
    5. Set up data stream:
       - Platform: Web
       - Website URL: https://tgyardcare.com
       - Stream name: TotalGuard Yard Care Website
    6. Copy the Measurement ID (format: G-XXXXXXXXXX)
       - Found under: Admin -> Data Streams -> [your stream] -> Measurement ID

    Reply with the Measurement ID in format: "G-XXXXXXXXXX"
  </action>
  <verify>N/A - human setup</verify>
  <done>User provides Google Analytics 4 Measurement ID</done>
</task>

<task type="auto">
  <name>Add GA4 tracking script to website</name>
  <files>index.html</files>
  <action>
    Add the Google Analytics 4 tracking script to the site's head section.

    1. Open index.html (root of project)
    2. Add the following script tags in the `<head>` section, before the closing `</head>` tag:

    ```html
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XXXXXXXXXX');
    </script>
    ```

    Replace `G-XXXXXXXXXX` with the actual Measurement ID from the previous task.

    Note: This script should be placed as high in the <head> as possible for accurate tracking. The async attribute ensures it doesn't block page rendering.

    Alternative if using environment variables:
    If Lovable supports runtime env vars in HTML, you can use:
    ```html
    <script async src="https://www.googletagmanager.com/gtag/js?id=%VITE_GA_MEASUREMENT_ID%"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '%VITE_GA_MEASUREMENT_ID%');
    </script>
    ```
    And set VITE_GA_MEASUREMENT_ID in Lovable env settings.

    However, hardcoding is simpler and fine for single-property tracking.
  </action>
  <verify>
    1. Commit and push changes to trigger Lovable rebuild
    2. Visit tgyardcare.com
    3. Open browser DevTools -> Network tab
    4. Refresh page
    5. Filter for "gtag" or "google-analytics"
    6. Should see requests to google-analytics.com/g/collect
    7. Open DevTools -> Console
    8. Type: gtag
    9. Should show function definition (not undefined)
  </verify>
  <done>GA4 tracking script added to index.html and loads on every page</done>
</task>

<task type="auto">
  <name>Create analytics helper utilities for event tracking</name>
  <files>src/lib/analytics.ts</files>
  <action>
    Create utility functions to standardize analytics event tracking across the site.

    Create src/lib/analytics.ts:
    ```typescript
    /**
     * Track a custom event in Google Analytics
     */
    export function trackEvent(eventName: string, eventParams?: Record<string, any>) {
      if (typeof window !== 'undefined' && window.gtag) {
        window.gtag('event', eventName, eventParams)
      } else {
        console.warn('Google Analytics not loaded')
      }
    }

    /**
     * Track a page view
     */
    export function trackPageView(pagePath: string, pageTitle?: string) {
      if (typeof window !== 'undefined' && window.gtag) {
        window.gtag('event', 'page_view', {
          page_path: pagePath,
          page_title: pageTitle || document.title,
        })
      }
    }

    /**
     * Track form submission
     */
    export function trackFormSubmit(formName: string, additionalData?: Record<string, any>) {
      trackEvent('form_submit', {
        form_name: formName,
        ...additionalData,
      })
    }

    /**
     * Track button or link clicks
     */
    export function trackClick(elementName: string, elementType: 'button' | 'link') {
      trackEvent('click', {
        element_name: elementName,
        element_type: elementType,
      })
    }

    // Type declaration for gtag
    declare global {
      interface Window {
        gtag?: (
          command: 'config' | 'event' | 'js' | 'set',
          targetId: string | Date,
          config?: Record<string, any>
        ) => void
        dataLayer?: any[]
      }
    }
    ```

    This provides type-safe analytics tracking with graceful fallback if GA isn't loaded.

    Note: The contact form in Plan 02-02 references window.gtag directly. This utility provides a cleaner alternative but both approaches work.
  </action>
  <verify>
    Check that analytics.ts compiles without errors:
    ```bash
    cd C:\Users\vance\OneDrive\Desktop\claude-workspace\tgyardcare
    npm run build
    ```
    Should complete with no TypeScript errors.
  </verify>
  <done>src/lib/analytics.ts exists with helper functions for tracking events, page views, and form submissions</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Google Analytics 4 tracking integration with automatic page view tracking and custom event utilities.
  </what-built>
  <how-to-verify>
    1. Verify script loading:
       - Open tgyardcare.com in browser
       - Open DevTools -> Network tab
       - Refresh page
       - Look for requests to "google-analytics.com" or "googletagmanager.com"
       - Should see successful requests (status 200)

    2. Verify gtag function:
       - Open DevTools -> Console
       - Type: window.gtag
       - Should show: function gtag() {...} (not undefined)
       - Type: window.dataLayer
       - Should show: Array with events

    3. Test real-time tracking:
       - Open Google Analytics dashboard
       - Go to Reports -> Realtime
       - In another browser tab, visit tgyardcare.com
       - Within 30 seconds, should see yourself as an active user in GA Realtime report
       - Navigate to different pages on site
       - Should see page views increment in Realtime

    4. Test event tracking (if contact form already wired from Plan 02-02):
       - Submit contact form
       - In GA Realtime -> Events, should see "form_submit" event appear within 30-60 seconds

    Expected behavior:
    - GA script loads without errors
    - Page views tracked automatically
    - Realtime reports show activity
    - No console errors related to analytics

    Note: Historical data takes 24-48 hours to populate in GA reports. Realtime is immediate.

    If everything works correctly, reply: "approved"

    If issues, describe what's not working (e.g., "script not loading", "no data in realtime", "gtag undefined").
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues encountered</resume-signal>
</task>

</tasks>

<verification>
Overall verification checks:

1. GA4 property created with correct settings
2. Measurement ID obtained and added to index.html
3. GA tracking script loads on every page
4. gtag function available in browser console
5. Analytics helper utilities exist and compile
6. Page views tracked automatically
7. Custom events can be tracked via utilities
8. Realtime data appears in GA4 dashboard
9. No console errors related to analytics
</verification>

<success_criteria>
Plan complete when:

1. Google Analytics 4 property created for tgyardcare.com
2. GA4 tracking script added to index.html with correct Measurement ID
3. Script loads successfully on every page
4. Page views tracked automatically
5. Analytics utility functions available for custom events
6. Realtime tracking verified in GA4 dashboard
7. Form submission events will be tracked (via Plan 02-02 integration)

Measurable: Visit website, see yourself in GA4 Realtime report within 30 seconds, navigate pages and see page view counts increment.
</success_criteria>

<output>
After completion, create `.planning/phases/02-supabase-backend/02-04-SUMMARY.md` with:
- Google Analytics property details (ID, property name)
- Measurement ID used
- GA4 script location (index.html)
- Analytics utilities created
- Verification results from Realtime tracking
- Note about 24-48 hour delay for historical reports
</output>
